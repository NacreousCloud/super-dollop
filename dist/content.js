class k{static analyzeElement(t){var r;const e=((r=t.tagName)==null?void 0:r.toLowerCase())||"unknown",a=this.getRole(t),s=this.getAccessibleName(t),l=this.getAttributes(t),c=this.generateSelectorStrategies(t,a,s),o=this.analyzeAccessibility(t,a,s,c);return{id:this.generateId(t),tag:e,role:a,accessibleName:s,attributes:l,selectorStrategies:c,hasAccessibilityIssues:o.overallScore<70,labelingImprovements:o.improvements}}static getRole(t){var l;const e=t.getAttribute("role");if(e)return e;const a=((l=t.tagName)==null?void 0:l.toLowerCase())||"unknown";return{button:"button",a:t.hasAttribute("href")?"link":void 0,input:this.getInputRole(t),select:"combobox",textarea:"textbox",main:"main",nav:"navigation",header:"banner",footer:"contentinfo",aside:"complementary",section:"region",article:"article",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading"}[a]}static getInputRole(t){var s;const e=((s=t.type)==null?void 0:s.toLowerCase())||"text";return{button:"button",submit:"button",reset:"button",checkbox:"checkbox",radio:"radio",range:"slider",search:"searchbox"}[e]||"textbox"}static getAccessibleName(t){var l,c,o,r;const e=t.getAttribute("aria-label");if(e!=null&&e.trim())return e.trim();const a=t.getAttribute("aria-labelledby");if(a){const i=a.split(/\s+/).map(u=>{var b,g;return(g=(b=document.getElementById(u))==null?void 0:b.textContent)==null?void 0:g.trim()}).filter(Boolean).join(" ");if(i)return i}if(((l=t.tagName)==null?void 0:l.toLowerCase())==="input"){const i=t.getAttribute("id");if(i){const u=document.querySelector(`label[for="${i}"]`);if((c=u==null?void 0:u.textContent)!=null&&c.trim())return u.textContent.trim()}}if(((o=t.tagName)==null?void 0:o.toLowerCase())==="img"){const i=t.getAttribute("alt");if(i!==null)return i}const s=(r=t.textContent)==null?void 0:r.trim();if(s&&s.length<100)return s}static getAttributes(t){const e={};for(let a=0;a<t.attributes.length;a++){const s=t.attributes[a];e[s.name]=s.value}return e}static generateSelectorStrategies(t,e,a){const s={accessibility:{score:0,selector:"",available:!1},name:{score:0,selector:"",available:!1},testid:{score:0,selector:"",available:!1},css:{score:0,selector:"",available:!1}};if(e&&(s.accessibility={score:90,selector:`[role="${e}"]`,available:!0}),a){const o=t.getAttribute("aria-label")?`[aria-label="${a}"]`:`[aria-labelledby*="${t.getAttribute("aria-labelledby")}"]`;s.name={score:85,selector:o,available:!0}}const l=t.getAttribute("data-testid");l&&(s.testid={score:95,selector:`[data-testid="${l}"]`,available:!0});const c=this.generateCSSSelector(t);return s.css={score:Math.max(30,70-c.split(" ").length*10),selector:c,available:!0},s}static generateCSSSelector(t){var s,l;const e=[];let a=t;for(;a&&a.nodeType===Node.ELEMENT_NODE&&e.length<6;){let c=((s=a.nodeName)==null?void 0:s.toLowerCase())||"unknown";if(a.id){c+=`#${CSS.escape(a.id)}`,e.unshift(c);break}const o=Array.from(((l=a.parentElement)==null?void 0:l.children)||[]).filter(r=>r.nodeName===a.nodeName);if(o.length>1&&a){const r=o.indexOf(a)+1;c+=`:nth-of-type(${r})`}e.unshift(c),a=a.parentElement}return e.join(" > ")}static analyzeAccessibility(t,e,a,s){const l=[],c=[];let o=100;if(e||(l.push("역할(role)이 명시되지 않음"),c.push("적절한 role 속성 추가"),o-=20),!a&&this.needsAccessibleName(t)&&(l.push("접근 가능한 이름이 없음"),c.push("aria-label 또는 연결된 label 추가"),o-=25),t.getAttribute("data-testid")||(c.push("data-testid 속성 추가 (테스트 안정성)"),o-=5),this.isInteractive(t)){const r=t;!t.hasAttribute("tabindex")&&r.tabIndex<0&&(l.push("키보드 접근이 불가능"),c.push("tabindex 속성 확인"),o-=15)}return{overallScore:Math.max(0,o),recommendations:c,criticalIssues:l.filter(r=>r.includes("접근 가능한 이름")||r.includes("키보드 접근")),improvements:c}}static needsAccessibleName(t){var s;const e=((s=t.tagName)==null?void 0:s.toLowerCase())||"unknown";return["button","a","input","select","textarea"].includes(e)||t.hasAttribute("role")}static isInteractive(t){var s;const e=((s=t.tagName)==null?void 0:s.toLowerCase())||"unknown";return["button","a","input","select","textarea"].includes(e)||t.hasAttribute("onclick")||t.hasAttribute("role")&&["button","link","menuitem","tab"].includes(t.getAttribute("role"))}static generateId(t){var e;return t.getAttribute("data-testid")||t.getAttribute("id")||`${((e=t.tagName)==null?void 0:e.toLowerCase())||"unknown"}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}let d=null,f=!1,h=null,y=null;function S(){return d||(d=document.createElement("div"),d.style.position="fixed",d.style.zIndex="2147483647",d.style.pointerEvents="none",d.style.border="2px solid #5b9cff",d.style.background="rgba(91,156,255,0.15)",d.style.borderRadius="3px",document.documentElement.appendChild(d),d)}function A(){d==null||d.remove(),d=null}function C(n){const t=n.getBoundingClientRect();return{left:t.left,top:t.top,width:t.width,height:t.height}}function N(n){const t=C(n),e=S();e.style.left=t.left+"px",e.style.top=t.top+"px",e.style.width=Math.max(0,t.width)+"px",e.style.height=Math.max(0,t.height)+"px";const a=k.analyzeElement(n),s=a.selectorStrategies.accessibility.score+a.selectorStrategies.name.score+a.selectorStrategies.testid.score;s>180?(e.style.border="2px solid #10b981",e.style.background="rgba(16,185,129,0.15)"):s>120?(e.style.border="2px solid #f59e0b",e.style.background="rgba(245,158,11,0.15)"):(e.style.border="2px solid #ef4444",e.style.background="rgba(239,68,68,0.15)")}function I(){f||(f=!0,S(),h=n=>{const t=n.target;t&&N(t)},y=n=>{n.preventDefault(),n.stopPropagation();const t=n.target;if(!t)return;const e=k.analyzeElement(t);chrome.runtime.sendMessage({type:"ELEMENT_PICKED",payload:{role:e.role,name:e.accessibleName,selector:e.selectorStrategies.css.selector,detailedAnalysis:e}}),w()},window.addEventListener("mousemove",h,!0),window.addEventListener("click",y,!0),document.body.style.cursor="crosshair")}function w(){f&&(f=!1,window.removeEventListener("mousemove",h,!0),window.removeEventListener("click",y,!0),h=null,y=null,document.body.style.cursor="",A())}chrome.runtime.onMessage.addListener((n,t,e)=>{var a,s,l,c;if(n.type==="START_INSPECT")I(),e({ok:!0});else if(n.type==="STOP_INSPECT")w(),e({ok:!0});else if(n.type==="PING")e({ok:!0});else if(n.type==="QUERY_ELEMENT"){const{selector:o}=n;try{const r=document.querySelector(o);e(r?{ok:!0,found:!0,element:{tagName:((a=r.tagName)==null?void 0:a.toLowerCase())||"unknown",textContent:((s=r.textContent)==null?void 0:s.trim())||"",value:r.value||"",attributes:Array.from(r.attributes).map(i=>({name:i.name,value:i.value}))}}:{ok:!0,found:!1})}catch(r){e({ok:!1,error:r instanceof Error?r.message:String(r)})}}else if(n.type==="CLICK_ELEMENT"){const{selector:o}=n;try{const r=document.querySelector(o);r?(r.click(),e({ok:!0,clicked:!0})):e({ok:!1,error:"요소를 찾을 수 없습니다"})}catch(r){e({ok:!1,error:r instanceof Error?r.message:String(r)})}}else if(n.type==="INPUT_ELEMENT"){const{selector:o,value:r}=n;try{const i=document.querySelector(o);i?(i.value=r,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),e({ok:!0,inputted:!0})):e({ok:!1,error:"요소를 찾을 수 없습니다"})}catch(i){e({ok:!1,error:i instanceof Error?i.message:String(i)})}}else if(n.type==="ASSERT_ELEMENT"){const{selector:o,assertion:r}=n;try{const i=document.querySelector(o);if(!i){e({ok:!0,success:!1,message:"요소를 찾을 수 없습니다",actual:null});return}let u=!1,b="",g=null;switch(r.type){case"element_exists":u=!0,b="요소가 존재합니다",g=!0;break;case"text_equals":const p=((l=i.textContent)==null?void 0:l.trim())||"";g=p,u=p===r.expected,b=u?"텍스트가 일치합니다":`텍스트가 일치하지 않습니다. 예상: "${r.expected}", 실제: "${p}"`;break;case"text_contains":const m=((c=i.textContent)==null?void 0:c.trim())||"";g=m,u=m.includes(r.expected),b=u?"텍스트를 포함합니다":`텍스트를 포함하지 않습니다. 예상: "${r.expected}", 실제: "${m}"`;break;case"value_equals":const x=i.value||"";g=x,u=x===r.expected,b=u?"값이 일치합니다":`값이 일치하지 않습니다. 예상: "${r.expected}", 실제: "${x}"`;break;case"attribute_equals":const v=i.getAttribute(r.attribute||"")||"";g=v,u=v===r.expected,b=u?"속성이 일치합니다":`속성이 일치하지 않습니다. 예상: "${r.expected}", 실제: "${v}"`;break;case"visible":const E=i.offsetWidth>0&&i.offsetHeight>0&&window.getComputedStyle(i).visibility!=="hidden"&&window.getComputedStyle(i).display!=="none";g=E,u=E===r.expected,b=u?"가시성이 일치합니다":`가시성이 일치하지 않습니다. 예상: ${r.expected}, 실제: ${E}`;break;default:u=!1,b=`지원하지 않는 검증 타입: ${r.type}`,g=null}e({ok:!0,success:u,message:b,actual:g})}catch(i){e({ok:!1,error:i instanceof Error?i.message:String(i)})}}return!0});
//# sourceMappingURL=content.js.map
