{"version":3,"file":"content.js","sources":["../extension/content.ts"],"sourcesContent":["import type { RuntimeMessage } from './types'\n\ntype StartInspectMsg = { type: 'START_INSPECT' }\ntype StopInspectMsg = { type: 'STOP_INSPECT' }\n\ntype PickedElementMeta = {\n  role: string | null\n  name: string | null\n  selector: string\n}\n\nlet overlay: HTMLDivElement | null = null\nlet inspecting = false\nlet onMouseMove: ((e: MouseEvent) => void) | null = null\nlet onClickPick: ((e: MouseEvent) => void) | null = null\n\nfunction ensureOverlay() {\n  if (overlay) return overlay\n  overlay = document.createElement('div')\n  overlay.style.position = 'fixed'\n  overlay.style.zIndex = '2147483647'\n  overlay.style.pointerEvents = 'none'\n  overlay.style.border = '2px solid #5b9cff'\n  overlay.style.background = 'rgba(91,156,255,0.15)'\n  overlay.style.borderRadius = '3px'\n  document.documentElement.appendChild(overlay)\n  return overlay\n}\n\nfunction removeOverlay() {\n  overlay?.remove()\n  overlay = null\n}\n\nfunction rectOf(el: Element) {\n  const r = el.getBoundingClientRect()\n  return { left: r.left, top: r.top, width: r.width, height: r.height }\n}\n\nfunction updateOverlay(el: Element) {\n  const box = rectOf(el)\n  const o = ensureOverlay()\n  o.style.left = box.left + 'px'\n  o.style.top = box.top + 'px'\n  o.style.width = Math.max(0, box.width) + 'px'\n  o.style.height = Math.max(0, box.height) + 'px'\n}\n\nfunction simpleRole(el: Element): string | null {\n  const roleAttr = el.getAttribute('role')\n  if (roleAttr) return roleAttr\n  const tag = el.tagName.toLowerCase()\n  if (tag === 'button') return 'button'\n  if (tag === 'a' && (el as HTMLAnchorElement).href) return 'link'\n  if (tag === 'input') {\n    const type = (el as HTMLInputElement).type\n    if (type === 'checkbox') return 'checkbox'\n    if (type === 'radio') return 'radio'\n    return 'textbox'\n  }\n  if (tag === 'select') return 'combobox'\n  if (tag === 'textarea') return 'textbox'\n  return null\n}\n\nfunction simpleName(el: Element): string | null {\n  const ariaLabel = el.getAttribute('aria-label')\n  if (ariaLabel) return ariaLabel.trim() || null\n  const labelledBy = el.getAttribute('aria-labelledby')\n  if (labelledBy) {\n    const text = labelledBy\n      .split(/\\s+/)\n      .map((id) => document.getElementById(id)?.textContent?.trim() || '')\n      .filter(Boolean)\n      .join(' ')\n      .trim()\n    if (text) return text\n  }\n  const alt = (el as HTMLElement).getAttribute?.('alt')\n  if (alt) return alt\n  const text = (el as HTMLElement).innerText?.trim() || ''\n  if (text) return text\n  return null\n}\n\nfunction cssPath(el: Element): string {\n  const parts: string[] = []\n  let node: Element | null = el\n  while (node && node.nodeType === Node.ELEMENT_NODE && parts.length < 6) {\n    let selector = node.nodeName.toLowerCase()\n    if (node.id) {\n      selector += `#${CSS.escape(node.id)}`\n      parts.unshift(selector)\n      break\n    } else {\n      let sib = node\n      let nth = 1\n      let ps: Element | null = sib.previousElementSibling\n      while (ps) {\n        if (ps.nodeName === node.nodeName) nth++\n        ps = ps.previousElementSibling\n      }\n      selector += `:nth-of-type(${nth})`\n    }\n    parts.unshift(selector)\n    node = node.parentElement\n  }\n  return parts.join(' > ')\n}\n\nfunction pickMeta(el: Element): PickedElementMeta {\n  return {\n    role: simpleRole(el),\n    name: simpleName(el),\n    selector: cssPath(el),\n  }\n}\n\nfunction startInspect() {\n  if (inspecting) return\n  inspecting = true\n  ensureOverlay()\n  onMouseMove = (e: MouseEvent) => {\n    const target = e.target as Element | null\n    if (!target) return\n    updateOverlay(target as Element)\n  }\n  onClickPick = (e: MouseEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    const target = e.target as Element | null\n    if (!target) return\n    const meta = pickMeta(target)\n    chrome.runtime.sendMessage({ type: 'ELEMENT_PICKED', payload: meta })\n    stopInspect()\n  }\n  window.addEventListener('mousemove', onMouseMove, true)\n  window.addEventListener('click', onClickPick, true)\n  document.body.style.cursor = 'crosshair'\n}\n\nfunction stopInspect() {\n  if (!inspecting) return\n  inspecting = false\n  window.removeEventListener('mousemove', onMouseMove as any, true)\n  window.removeEventListener('click', onClickPick as any, true)\n  onMouseMove = null\n  onClickPick = null\n  document.body.style.cursor = ''\n  removeOverlay()\n}\n\nchrome.runtime.onMessage.addListener((msg: RuntimeMessage, _sender, sendResponse) => {\n  if (msg.type === 'START_INSPECT') startInspect()\n  else if (msg.type === 'STOP_INSPECT') stopInspect()\n  else if (msg.type === 'PING') {\n    sendResponse({ ok: true })\n  }\n}) "],"names":["overlay","inspecting","onMouseMove","onClickPick","ensureOverlay","removeOverlay","rectOf","el","r","updateOverlay","box","o","simpleRole","roleAttr","tag","type","simpleName","_a","_b","ariaLabel","labelledBy","text","id","alt","cssPath","parts","node","selector","sib","nth","ps","pickMeta","startInspect","target","meta","stopInspect","msg","_sender","sendResponse"],"mappings":"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"}